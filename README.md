–ì–æ—Ç–æ–≤–æ! –ù–∏–∂—á–µ ‚Äî –≥–æ—Ç–æ–≤–∏–π README —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π. –Ø –≤—Ä–∞—Ö—É–≤–∞–≤, —â–æ —Ü–µ **MVC-–ø—Ä–∏–∫–ª–∞–¥** –Ω–∞ **ASP.NET Core 8**, —Ñ—Ä–æ–Ω—Ç ‚Äî **–∑–≤–∏—á–∞–π–Ω–∞ HTML+CSS+JS** —Å—Ç–æ—Ä—ñ–Ω–∫–∞, –ë–î ‚Äî **SQL Server**, –ø–æ—Ä—Ç **7099**, —ñ —Ç–≤—ñ–π `appsettings.json`.

---

# üß© SPA ¬´–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ¬ª ‚Äî ASP.NET Core 8 MVC + EF Core + SQL Server

–ú—ñ–Ω—ñ–∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ (–ø—Ä–∏–∫–ª–∞–¥ **MVC**) –¥–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥—É –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —ñ–∑ –≤–∫–ª–∞–¥–µ–Ω–∏–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—è–º–∏, –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é, —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è–º —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º —Ñ–∞–π–ª—ñ–≤. –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —è–∫ –∑–≤–∏—á–∞–π–Ω–∞ **HTML + CSS + JS** —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –±–µ–∑ –æ–∫—Ä–µ–º–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞.

## –ó–º—ñ—Å—Ç

* [–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó](#—Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó)
* [–ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ](#–º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ)
* [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É (–¥—ñ–∞–≥—Ä–∞–º–∞)](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ—î–∫—Ç—É-–¥—ñ–∞–≥—Ä–∞–º–∞)
* [–®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç](#—à–≤–∏–¥–∫–∏–π-—Å—Ç–∞—Ä—Ç)
* [–ú—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö](#–º—ñ–≥—Ä–∞—Ü—ñ—ó-–±–∞–∑–∏-–¥–∞–Ω–∏—Ö)
* [–ü–∞–≥—ñ–Ω–∞—Ü—ñ—è, —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∫–ª–∞–¥–µ–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ](#–ø–∞–≥—ñ–Ω–∞—Ü—ñ—è-—Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è-—Ç–∞-–≤–∫–ª–∞–¥–µ–Ω—ñ-–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ)
* [API (–æ–≥–ª—è–¥)](#api-–æ–≥–ª—è–¥)
* [–†–æ–∞–¥–º–∞–ø](#—Ä–æ–∞–¥–º–∞–ø)

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

* **.NET 8 / ASP.NET Core MVC**
* **Entity Framework Core** (Code-First, Migrations)
* **SQL Server**
* **WebSockets** –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω—å —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ (–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –Ω–æ–≤—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ)
* –ß–∏—Å—Ç–∞ **HTML/CSS/JS** —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —è–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (–±–µ–∑ React/Vue/Angular)

---

## –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

* –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è: *User Name*, *Email*, *Home page*, *CAPTCHA*, *Text* (–¥–æ–∑–≤–æ–ª–µ–Ω—ñ —Ç—ñ–ª—å–∫–∏ `<a>`, `<code>`, `<i>`, `<strong>`).
* –í–∫–ª–∞–¥–µ–Ω—ñ/–∫–∞—Å–∫–∞–¥–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ.
* –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–Ω–∏—Ö –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ –∑–∞ **User Name / Email / –¥–∞—Ç–æ—é** —É –¥–≤–æ—Ö –Ω–∞–ø—Ä—è–º–∞—Ö; –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º ‚Äî **LIFO**.
* –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è: **25 –∑–∞–ø–∏—Å—ñ–≤ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É**.
* –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤: –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è **JPG/GIF/PNG** (–∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–± –¥–æ **320√ó240**) —ñ **.txt** –¥–æ **100 KB**; –ø–µ—Ä–µ–≥–ª—è–¥ —ñ–∑ lightbox-–µ—Ñ–µ–∫—Ç–æ–º.
* –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ **XSS** (—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è HTML) —ñ **SQL-—ñ–Ω‚Äô—î–∫—Ü—ñ–π** (EF Core / –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏).

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É (–¥—ñ–∞–≥—Ä–∞–º–∞)

```text
comment/
‚îú‚îÄ Connected Services/
‚îú‚îÄ Properties/
‚îú‚îÄ wwwroot/                     # —Å—Ç–∞—Ç–∏–∫–∞ (css, js, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, lightbox)
‚îú‚îÄ Controllers/
‚îÇ  ‚îú‚îÄ CommentController.cs      # CRUD/Replies/Sorting/Pagination
‚îÇ  ‚îî‚îÄ HomeController.cs         # Index (SPA shell)
‚îú‚îÄ Data/
‚îÇ  ‚îú‚îÄ Model/
‚îÇ  ‚îÇ  ‚îú‚îÄ Comment.cs             # —Å—É—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–µ–Ω—Ç–∞—Ä—è (ParentId –¥–ª—è –≤–∫–ª–∞–¥–µ–Ω–æ—Å—Ç—ñ)
‚îÇ  ‚îÇ  ‚îú‚îÄ Attachment.cs          # —Å—É—Ç–Ω—ñ—Å—Ç—å –≤–∫–ª–∞–¥–µ–Ω—å
‚îÇ  ‚îÇ  ‚îú‚îÄ AttachmentType.cs
‚îÇ  ‚îÇ  ‚îú‚îÄ CommentQueueItem.cs    # –µ–ª–µ–º–µ–Ω—Ç —á–µ—Ä–≥–∏ –æ–±—Ä–æ–±–∫–∏
‚îÇ  ‚îÇ  ‚îî‚îÄ RECaptcha.cs           # DTO/–º–æ–¥–µ–ª—å –¥–ª—è CAPTCHA
‚îÇ  ‚îî‚îÄ AppDbContext.cs           # EF Core DbContext
‚îú‚îÄ EventHandlers/
‚îÇ  ‚îî‚îÄ CommentAddedEventHandler.cs
‚îú‚îÄ Events/
‚îÇ  ‚îî‚îÄ CommentAddedEvent.cs
‚îú‚îÄ Interface/
‚îÇ  ‚îú‚îÄ IAttachmentRepository.cs
‚îÇ  ‚îî‚îÄ ICommentRepository.cs
‚îú‚îÄ Migrations/                  # EF Core –º—ñ–≥—Ä–∞—Ü—ñ—ó
‚îú‚îÄ Repository/
‚îÇ  ‚îú‚îÄ AttachmentRepository.cs
‚îÇ  ‚îî‚îÄ CommentRepository.cs
‚îú‚îÄ Services/
‚îÇ  ‚îú‚îÄ Interface/
‚îÇ  ‚îÇ  ‚îî‚îÄ IQueueService.cs
‚îÇ  ‚îú‚îÄ Repository/
‚îÇ  ‚îÇ  ‚îî‚îÄ QueueService.cs
‚îÇ  ‚îî‚îÄ WebSocket/
‚îÇ     ‚îî‚îÄ WebSocketHandler.cs
‚îú‚îÄ Views/
‚îÇ  ‚îî‚îÄ Home/
‚îÇ     ‚îî‚îÄ Index.cshtml           # HTML + CSS + JS UI
‚îú‚îÄ appsettings.json
‚îú‚îÄ appsettings.Development.json # (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ; –ª–æ–∫–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è)
‚îî‚îÄ Program.cs
```

---

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### –í–∏–º–æ–≥–∏

* **.NET SDK 8.0**
* **SQL Server** (–ª–æ–∫–∞–ª—å–Ω–æ –∞–±–æ —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ Docker)
* Windows/Linux/macOS ‚Äî –±–µ–∑ —Ä—ñ–∑–Ω–∏—Ü—ñ

### –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫

```bash
git clone https://github.com/<your-account>/<your-repo>.git
cd <your-repo>

# 1) –û–ù–û–í–ò —Ä—è–¥–æ–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —É appsettings.json –∞–±–æ —É appsettings.Development.json
# 2) –ó–∞—Å—Ç–æ—Å—É–π –º—ñ–≥—Ä–∞—Ü—ñ—ó –ë–î
dotnet tool install --global dotnet-ef
dotnet ef database update

# 3) –ó–∞–ø—É—Å—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫
dotnet run
```

–ü—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —Å–ª—É—Ö–∞—î **Kestrel** –Ω–∞ `http://localhost:7099`. –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ ‚Äî `GET /` (–≤—ñ–¥–¥–∞—î `Views/Home/Index.cshtml`).

---

## –ú—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

```bash
# —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é
dotnet ef migrations add Init

# –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó
dotnet ef database update

# –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å—Ç–∞–Ω—É
dotnet ef database update <PreviousMigrationName>
```

---

## –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è, —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∫–ª–∞–¥–µ–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

* –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è: **25 –∑–∞–ø–∏—Å—ñ–≤/—Å—Ç–æ—Ä—ñ–Ω–∫–∞** (query-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏ `page`, `pageSize`).
* –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è: `sort=UserName|Email|Date` —ñ `dir=asc|desc`; –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º ‚Äî **LIFO**.
* –í–∫–ª–∞–¥–µ–Ω—ñ—Å—Ç—å: —É —Å—É—Ç–Ω–æ—Å—Ç—ñ `Comment` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `ParentId` –¥–ª—è —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –¥–µ—Ä–µ–≤–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π.

---

## API (–æ–≥–ª—è–¥)

> –£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–∏–π –æ–≥–ª—è–¥ –∑–∞ —Ä–æ–ª—è–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ–≤. –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî –¥–æ–¥–∞–º –ø–æ–≤–Ω—É —Ç–∞–±–ª–∏—Ü—é –µ–Ω–¥–ø–æ–π–Ω—Ç—ñ–≤ (URL/–º–µ—Ç–æ–¥/—Ç—ñ–ª–æ/–≤—ñ–¥–ø–æ–≤—ñ–¥—å) –∑ –ø—Ä–∏–∫–ª–∞–¥–∞–º–∏ `curl`.

* `GET /api/comments` ‚Äî –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∑–∞–≥–æ–ª–æ–≤–Ω–∏—Ö –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ (–∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é/—Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è–º).
* `GET /api/comments/{id}` ‚Äî –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä —ñ–∑ –≤–∫–ª–∞–¥–µ–Ω–∏–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—è–º–∏.
* `POST /api/comments` ‚Äî —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä (–≤–∞–ª—ñ–¥–∞—Ü—ñ—è CAPTCHA, —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è HTML).
* `POST /api/comments/{id}/reply` ‚Äî –¥–æ–¥–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å.
* `POST /api/attachments` ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∏–ø—É/—Ä–æ–∑–º—ñ—Ä—É).
* `GET /attachments/{id}` ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏/–ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–∫–ª–∞–¥–µ–Ω–Ω—è.
* WebSocket: `ws://localhost:7099/ws` ‚Äî –ø—É—à –æ–Ω–æ–≤–ª–µ–Ω—å –¥–ª—è –Ω–æ–≤–∏—Ö –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤.

---

## –†–æ–∞–¥–º–∞–ø

* [ ] **Swagger/OpenAPI** –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è API.
* [ ] **Unit/Integration tests** –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó —ñ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏.
* [ ] **Dockerfile / docker-compose** (API + SQL Server) –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø—ñ–¥–Ω—è—Ç—Ç—è —Å—Ç–µ–∫–∞.
* [ ] Seed-–¥–∞–Ω—ñ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–µ–º–æ.



–•–æ—á–µ—à ‚Äî –Ω–∞–¥—ñ—à–ª–∏ –º–µ–Ω—ñ —Ç–æ—á–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏/DTO –∑ `CommentController.cs`, —ñ —è —Ä–æ–∑–ø–∏—à—É –ø–æ–≤–Ω—É —Ç–∞–±–ª–∏—Ü—é API + –ø—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–ø–∏—Ç—ñ–≤/–≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π. –Ø–∫—â–æ –¥–æ–¥–∞—Å–∏ `Dockerfile` ‚Äî –≤–∫–ª—é—á—É —Ä–æ–∑–¥—ñ–ª ¬´–ó–∞–ø—É—Å–∫ —É Docker¬ª.
